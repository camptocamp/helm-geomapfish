shared:
  redisEnv: &redisEnv
    C2C_REDIS_URL:
      value: redis://test-redis-master/1
    C2C_REDIS_TIMEOUT:
      value: 30
    C2C_BROADCAST_PREFIX:
      type: configMap
      name: env
      key: REDIS_GEOPORTAL_BROADCAST_PREFIX

  c2cwsgiutilsEnv: &c2cwsgiutilsEnv
    C2C_LOG_VIEW_ENABLED:
      value: 1
    C2C_DEBUG_VIEW_ENABLED:
      value: 1
    C2C_SQL_PROFILER_ENABLED:
      value: 1
    LOG_TYPE:
      value: console
    C2C_REQUESTS_DEFAULT_TIMEOUT:
      value: 30
    GUNICORN_WORKERS:
      value: 2
    GUNICORN_THREADS:
      value: 10
    GUNICORN_TIMEOUT:
      value: 30
    GUNICORN_MAX_REQUESTS:
      value: 2000
    GUNICORN_MAX_REQUESTS_JITTER:
      value: 200
    GUNICORN_LIMIT_REQUEST_LINE:
      value: 8190
    GUNICORN_ACCESS_LOG_FORMAT:
      value: '%(H)s %({Host}i)s %(m)s %(U)s?%(q)s "%(f)s" "%(a)s" %(s)s %(B)s %(D)s %(p)s'

  dbEnv: &dbEnv
    PGPORT:
      value: 5432
    PGPORT_SLAVE:
      value: 5432
    PGHOST:
      value: test-pg-postgresql
    PGHOST_SLAVE:
      value: test-pg-postgresql
    PGDATABASE:
      value: postgres
    PGUSER:
      value: postgres
    PGPASSWORD:
      value: mySuperTestingPassword
    PGSCHEMA:
      type: configMap
      name: env
      key: PGSCHEMA
    PGSCHEMA_STATIC:
      type: configMap
      name: env
      key: PGSCHEMA_STATIC
    PGOPTIONS:
      type: configMap
      name: env
      key: PGOPTIONS

  configEnv: &configEnv
    <<: *dbEnv
    TILECLOUDCHAIN_INTERNAL_URL:
      type: configMap
      name: env
      key: TILECLOUDCHAIN_INTERNAL_URL
    GEOPORTAL_INTERNAL_URL:
      type: configMap
      name: env
      key: GEOPORTAL_INTERNAL_URL
    VISIBLE_WEB_HOST:
      type: configMap
      name: env
      key: VISIBLE_WEB_HOST
    VISIBLE_WEB_PROTOCOL:
      value: https
    VISIBLE_ENTRY_POINT:
      type: configMap
      name: env
      key: VISIBLE_ENTRY_POINT
    MAPSERVER_DATA_SUBSELECT:
      type: configMap
      name: env
      key: MAPSERVER_DATA_SUBSELECT
    MAPSERVER_DATA_NOAREA_SUBSELECT:
      type: configMap
      name: env
      key: MAPSERVER_DATA_NOAREA_SUBSELECT
    MAPSERVER_JOIN_TABLES:
      type: configMap
      name: env
      key: MAPSERVER_JOIN_TABLES
    MAPSERVER_JOIN_WHERE:
      type: configMap
      name: env
      key: MAPSERVER_JOIN_WHERE
    QGISSERVER_URL:
      type: configMap
      name: env
      key: QGISSERVER_URL

image: &geoportal-image
  repository: camptocamp/geomapfishapp-geoportal
  tag: 2.7
env:
  <<: [*configEnv, *c2cwsgiutilsEnv]
  SENTRY_CLIENT_RELEASE:
    type: configMap
    name: env
    key: GEOPORTAL_CLIENT_RELEASE
  SENTRY_TAG_SERVICE:
    value: geoportal
  AUTHTKT_SECRET:
    value: secret012345678901234567890123456789012345678901234567890123456789
resources:
  limits:
    memory: 400Mi
  requests:
    memory: 271Mi
    cpu: 88m

configMapNameOverride:
  env: test-geomapfish-env

config:
  image:
    repository: camptocamp/geomapfishdemo-config
    tag: prod-2-7
  env:
    <<: *configEnv
    VISIBLE_WEB_PROTOCOL:
      value: https

alembic:
  image: *geoportal-image
  mainStatic: true
  env:
    <<: [*configEnv, *c2cwsgiutilsEnv]
    SENTRY_CLIENT_RELEASE:
      type: configMap
      name: env
      key: ALEMBIC_CLIENT_RELEASE
    SENTRY_TAG_SERVICE:
      value: alembic
  resources:
    limits:
      memory: 200Mi
    requests:
      memory: 171Mi
      cpu: 88m

tools:
  image:
    repository: camptocamp/geomapfish-tools
    tag: 2.7
  env:
    <<: *configEnv
  resources:
    limits:
      memory: 200Mi
    requests:
      memory: 100Mi
      cpu: 1m

mutualize:
  repository: camptocamp/test
  branch: master
  key: admin1234
  # Should be https://config.mutualize(-int)?.camptocamp.com
  configUrl: https://config.mutualized.example.com
  configs:
    test-print:
      dir: print/print-apps/test
      env:
        TEST: test
    test-tilecloudchain:
      hosts:
        - name: main
          host: demo.camptocamp.com
        - name: test
          host: demo-test.camptocamp.com
      dir: tilegeneration
      tilecloudchain: true
      env:
        TEST: test

ingress:
  enabled: true
  paths:
    - /
  hosts:
    - name: main
      host: gmf.local
      tls:
        secretName: mytls
  additionalPaths:
    customFeedback:
      path: /custom/
      service: geomapfish-env-version-custom-feedback

postgresql:
  schema: main
  staticSchema: main_static

redis:
  host: redis
